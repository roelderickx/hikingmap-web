function add_tracks(e){for(var t=0;t<get_amount_tracks();t++){var o=new OpenLayers.Layer.Vector("track_"+t);o.style={strokeColor:track_color,strokeWidth:track_width,strokeOpacity:track_opacity},o.projection=new OpenLayers.Projection("EPSG:4326");var r=new OpenLayers.Format.EncodedPolyline({geometryType:"linestring"});o.addFeatures(new OpenLayers.Feature.Vector(r.read(get_track(t)).geometry.transform("EPSG:4326","EPSG:3857"))),e.addLayer(o)}}function add_waypoints(e){for(var t=0;t<get_amount_waypoints();t++){var o=new OpenLayers.Layer.Vector("wpt_"+t);o.projection=new OpenLayers.Projection("EPSG:4326");for(var r=new OpenLayers.Format.EncodedPolyline({geometryType:"multipoint"}).read(get_waypoints(t)).geometry.transform("EPSG:4326","EPSG:3857").getVertices(),n=0;n<r.length;n++){var a=new OpenLayers.Feature.Vector(r[n]);a.style={label:""+n,fontFamily:waypoint_font,fontSize:waypoint_font_size,fontColor:waypoint_font_color,labelOutlineWidth:waypoint_outline_width,labelOutlineColor:waypoint_outline_color},o.addFeatures(a)}e.addLayer(o)}}function add_pages(t,o,r,n){for(var e=get_page_extents(),a=new OpenLayers.Layer.Boxes("Pages"),i=0;i<e.length;i++)bounds=OpenLayers.Bounds.fromArray(e[i]).transform("EPSG:4326","EPSG:900913"),page=new OpenLayers.Marker.Box(bounds),page.events.register("mouseup",page,function(e){return t.dragging||show_page(this.bounds,o,r,n),t.events.handleBrowserEvent(e),!0}),page.setBorder(page_border_color,page_border_width),a.addMarker(page);t.addLayer(a)}function get_max_extent(){return new OpenLayers.Bounds(-20037508.342789244,-20037508.342789244,20037508.342789244,20037508.342789244)}function get_max_resolution(){return tile_size=256,project_ext=get_max_extent(),Math.min(Math.abs(project_ext.right-project_ext.left)/tile_size,Math.abs(project_ext.top-project_ext.bottom)/tile_size)}function get_optimal_zoom(e,t,o){return max_res=get_max_resolution(),zoom_width=Math.log(t*max_res/(e.right-e.left))/Math.log(2),zoom_height=Math.log(o*max_res/(e.top-e.bottom))/Math.log(2),Math.floor(Math.min(zoom_width,zoom_height))}function show_overview(e,t,o,r,n,a,i){var s={projection:new OpenLayers.Projection("EPSG:900913"),displayProjection:new OpenLayers.Projection("EPSG:4326"),units:"m",maxResolution:get_max_resolution(),maxExtent:get_max_extent(),numZoomLevels:20,controls:[new OpenLayers.Control.Navigation,new OpenLayers.Control.PanZoomBar,new OpenLayers.Control.Permalink,new OpenLayers.Control.ScaleLine,new OpenLayers.Control.MousePosition,new OpenLayers.Control.KeyboardDefaults,new OpenLayers.Control.Attribution]};map=new OpenLayers.Map("OverviewMap",s);var p=new OpenLayers.Layer.OSM("Default",tileserver,{numZoomLevels:19});map.addLayer(p),map.zoomIn(),add_tracks(map),add_pages(map,n,a,i);var l=new OpenLayers.Bounds(e,t,o,r).transform(new OpenLayers.Projection("EPSG:4326"),map.getProjectionObject());viewport_width=document.getElementById("OverviewMap").clientWidth,viewport_height=document.getElementById("OverviewMap").clientHeight;var _=get_optimal_zoom(l,viewport_width,viewport_height);map.setCenter(l.getCenterLonLat(),_)}function show_page(e,t,o,r){document.getElementById("DetailMapOverlay").style.display="block",document.getElementById("DetailMap").innerHTML="",document.getElementById("fade").style.display="block";var n={projection:new OpenLayers.Projection("EPSG:900913"),displayProjection:new OpenLayers.Projection("EPSG:4326"),units:"m",maxResolution:get_max_resolution(),maxExtent:get_max_extent(),numZoomLevels:20,controls:[new OpenLayers.Control.ScaleLine,new OpenLayers.Control.Attribution]};preferred_xsize=Math.floor(t/2.54*r),preferred_ysize=Math.floor(o/2.54*r),e.right-e.left>e.top-e.bottom&&(temp=preferred_xsize,preferred_xsize=preferred_ysize,preferred_ysize=temp),zoom=get_optimal_zoom(e,preferred_xsize,preferred_ysize),res=get_max_resolution()/Math.pow(2,zoom),xsize=Math.floor((e.right-e.left)/res),ysize=Math.floor((e.top-e.bottom)/res),document.getElementById("DetailMap").setAttribute("style","width:"+xsize+"px;height:"+ysize+"px"),document.getElementById("DetailMap").style.width=xsize+"px",document.getElementById("DetailMap").style.height=ysize+"px",map=new OpenLayers.Map("DetailMap",n);var a=new OpenLayers.Layer.OSM("Default",tileserver);map.addLayer(a),add_tracks(map),add_waypoints(map),map.setCenter(e.getCenterLonLat(),zoom)}function close_page(){document.getElementById("DetailMapOverlay").style.display="none",document.getElementById("fade").style.display="none"}tileserver="/osm_tiles/${z}/${x}/${y}.png",page_border_color="red",page_border_width=2,track_color="green",track_width=5,track_opacity=.5,waypoint_font="Arial, Helvetica, sans-serif",waypoint_font_size=12,waypoint_font_color="black",waypoint_outline_width=1,waypoint_outline_color="white";