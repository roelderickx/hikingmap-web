function add_tracks(e){for(var a=0;a<get_amount_tracks();a++){var n=new OpenLayers.Layer.Vector("track_"+a);n.style={strokeColor:track_color,strokeWidth:track_width,strokeOpacity:track_opacity},n.projection=new OpenLayers.Projection("EPSG:4326");var t=new OpenLayers.Format.EncodedPolyline({geometryType:"linestring"});n.addFeatures(new OpenLayers.Feature.Vector(t.read(get_track(a)).geometry.transform("EPSG:4326","EPSG:3857"))),e.addLayer(n)}}function add_waypoints(e){for(var a=0;a<get_amount_waypoints();a++){var n=new OpenLayers.Layer.Vector("wpt_"+a);n.projection=new OpenLayers.Projection("EPSG:4326");for(var t=new OpenLayers.Format.EncodedPolyline({geometryType:"multipoint"}).read(get_waypoints(a)).geometry.transform("EPSG:4326","EPSG:3857").getVertices(),r=0;r<t.length;r++){var o=new OpenLayers.Feature.Vector(t[r]);o.style={label:""+r,fontFamily:waypoint_font,fontSize:waypoint_font_size,fontColor:waypoint_font_color,labelOutlineWidth:waypoint_outline_width,labelOutlineColor:waypoint_outline_color},n.addFeatures(o)}e.addLayer(n)}}tileserver="/osm_tiles/${z}/${x}/${y}.png",page_border_color="red",page_border_width=2,track_color="green",track_width=5,track_opacity=.5,waypoint_font="Arial, Helvetica, sans-serif",waypoint_font_size=12,waypoint_font_color="black",waypoint_outline_width=1,waypoint_outline_color="white";var dragstart=null;function add_pages(a){for(var e=get_page_extents(),n=new OpenLayers.Layer.Boxes("Pages"),t=0;t<e.length;t++)bounds=OpenLayers.Bounds.fromArray(e[t]).transform("EPSG:4326","EPSG:900913"),page=new OpenLayers.Marker.Box(bounds),page.events.register("mousedown",page,function(e){return dragstart={x:e.screenX,y:e.screenY},a.events.handleBrowserEvent(e),!0}),page.events.register("mouseup",page,function(e){return dragstart&&(Math.abs(dragstart.x-e.screenX)<5||Math.abs(dragstart.y-e.screenY)<5)?(dragstart=null,show_page(this.bounds)):dragstart=null,a.events.handleBrowserEvent(e),!0}),page.setBorder(page_border_color,page_border_width),n.addMarker(page);a.addLayer(n)}function show_overview(e,a,n){var t={projection:new OpenLayers.Projection("EPSG:900913"),displayProjection:new OpenLayers.Projection("EPSG:4326"),units:"m",maxResolution:156543.0339,maxExtent:new OpenLayers.Bounds(-20037508.34,-20037508.34,20037508.34,20037508.34),numZoomLevels:20,controls:[new OpenLayers.Control.Navigation,new OpenLayers.Control.PanZoomBar,new OpenLayers.Control.Permalink,new OpenLayers.Control.ScaleLine,new OpenLayers.Control.MousePosition,new OpenLayers.Control.KeyboardDefaults,new OpenLayers.Control.Attribution]};map=new OpenLayers.Map("OverviewMap",t);var r=new OpenLayers.Layer.OSM("Default",tileserver,{numZoomLevels:19});map.addLayer(r),map.zoomIn(),add_tracks(map),add_pages(map);var o=new OpenLayers.LonLat(e,a).transform(new OpenLayers.Projection("EPSG:4326"),map.getProjectionObject());map.setCenter(o,n)}function show_page(e){document.getElementById("DetailMap").style.display="block",document.getElementById("DetailMap").innerHTML='<div style="align=right"><a href="javascript:void(0)" onclick="close_page()">Close</a>',document.getElementById("fade").style.display="block";var a={projection:new OpenLayers.Projection("EPSG:900913"),displayProjection:new OpenLayers.Projection("EPSG:4326"),units:"m",maxResolution:156543.0339,maxExtent:new OpenLayers.Bounds(-20037508.34,-20037508.34,20037508.34,20037508.34),numZoomLevels:20,controls:[new OpenLayers.Control.MousePosition,new OpenLayers.Control.KeyboardDefaults]};map=new OpenLayers.Map("DetailMap",a);var n=new OpenLayers.Layer.OSM("Default",tileserver);map.addLayer(n),add_tracks(map),add_waypoints(map);var t=e.getCenterLonLat();map.setCenter(t,12)}function close_page(){document.getElementById("DetailMap").style.display="none",document.getElementById("fade").style.display="none"}